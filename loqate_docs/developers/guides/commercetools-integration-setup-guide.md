::::::::::::::::::::::::::::::::::::::::::::::::::: {#mainBodyContent role="main" tabindex="-1"}
:::::::::::::::::::::::::::::::::::::::::::::::::: gd
::::::::::::::::::::::::::::::::::::::::::::::::: {.gd__c style="--cols:12"}
:::::::::::::::::::::::::::::::::::::::::::::::: {.gd__i .section .gd--cen .ptop--96 .pbtm--128 .c12 style=" --cspan:12; --rspan:1; --cstart:1;"}
::::::::::::::::::::::::::::::::::::::::::::::: {.section .gd__s}
:::::::::::::::::::::::::::::::::::::::::::::: {.gd__a style="--cols: 12;--cspan: 12; --rspan: 1;"}
::::::::::::::::::::::::::::::::::::::::::::: {.gd__c style="--cols:12"}
::: {.gd__i .section .c3 .t-hide style=" --cspan:3; --rspan:1; --cstart:auto;"}
- [Loqate Basics](#){aria-expanded="false" toggle="dropdown"
  role="button"}

  ::: dd
  - [Start Here](/developers/getting-started/)
  - [Ways To Integrate](/developers/getting-started/ways-to-integrate/)
  - [Creating API Keys](/developers/getting-started/creating-api-keys/)
  - [List Of Endpoints](/developers/getting-started/list-of-endpoints/)
  - [API Security](/developers/getting-started/api-security/)
  - [Monitoring Account
    Usage](/developers/getting-started/monitoring-account-usage/)
  :::
- [Product support](#){aria-expanded="false" toggle="dropdown"
  role="button"}

  ::: dd
  - [Address Capture](/developers/address-capture/)
  - [Address Verify](/developers/address-verify/)
  - [Store Finder](/developers/store-finder/)
  - [Email Validation](/developers/email-validation/)
  - [Phone Validation](/developers/phone-verification/)
  - [Bank Validation](/developers/bank-verification/)
  - [Geocode](/developers/geocode/)
  - [Matchcode (legacy)](/developers/matchcode/)
  :::
- [Guides](#){aria-expanded="false" toggle="dropdown" role="button"}

  ::: {.dd .nav__side-menu}
  - [Address, Email and Phone Validation](#){aria-expanded="false"
    toggle="dropdown" role="button"}

    ::: dd
    - [Quick setup guide -- Address, Email and Phone
      Validation](/developers/guides/quick/)
    - [Advanced Setup Guide](/developers/guides/advanced-setup-guide/)
    - [Address Capture Integration Best
      Practice](/developers/guides/address-capture-integration-best-practice/)
    - [Enabling new Capture
      features](/developers/guides/enabling-new-capture-features/)
    - [SaaS Platform: Setting up a new
      service](/developers/guides/saas-platform-setting-up/)
    - [SaaS Platform: Integration
      options](/developers/guides/saas-platform-integration-options/)
    - [SaaS Platform: SDK](/developers/guides/saas-platform-sdk/)
    - [The Loqate Saas
      Platform](/developers/guides/the-loqate-saas-platform/)
    :::
  - [Data Maintenance](#){aria-expanded="false" toggle="dropdown"
    role="button"}

    ::: dd
    - [Data Maintenance - Post
      Processing](/developers/guides/data-maintenance-post-processing/)
    :::
  - [Data Sets](#){aria-expanded="false" toggle="dropdown"
    role="button"}

    ::: dd
    - [Consuming Premium Data
      Sets](/developers/guides/consuming-premium-data-sets/)
    - [Property Intelligence User
      Guide](/developers/guides/property-intelligence-user-guide/)
    - [Property Intelligence Data
      Directory](/developers/guides/property-intelligence-data-directory/)
    :::
  - [Integrations by platform](#){aria-expanded="false"
    toggle="dropdown" role="button"}

    ::: dd
    - [Adobe Commerce
      (Magento)](/developers/guides/adobe-commerce-magento-integration-guide/)
    - [BigCommerce](/developers/guides/bigcommerce/)
    - [commercetools](/developers/guides/commercetools-integration/)
    - [Microsoft Dynamics
      365](/developers/guides/loqate-for-microsoft-dynamics-365/)
    - [Shopify
      Plus](/developers/guides/the-loqate-shopify-integration-guide/)
    - [Shopware
      6](/developers/guides/loqate-plugin-for-shopware-6-configuration-guide/)
    :::
  - [Store Finder](#){aria-expanded="false" toggle="dropdown"
    role="button"}

    ::: dd
    - [How Does a Store Finder
      Work?](/developers/guides/how-does-a-store-finder-work/)
    - [Creating and Managing Location
      Lists](/developers/guides/creating-and-managing-location-lists/)
    - [How To Implement a Store
      Finder](/developers/guides/how-to-implement-a-store-finder/)
    - [Setting Up Store Finder
      Keys](/developers/guides/setting-up-store-finder-keys/)
    :::
  - [Utilities Register](#){aria-expanded="false" toggle="dropdown"
    role="button"}

    ::: dd
    - [Loqate Utilities Register
      2.0](/developers/guides/loqate-utilities-register/)
    :::
  :::
- [APIs](/developers/api/){aria-expanded="false" toggle="dropdown"
  role="button"}

  ::: dd
  - [Address Capture](/developers/api/capture/)
  - [Address Verify](/developers/api/cleanseplus/)
  - [Store Finder](/developers/apis/location-services/)
  - [Email Validation](/developers/api/emailvalidation/)
  - [Phone Validation](/developers/api/phonenumbervalidation/)
  - [Bank Validation](/developers/api/bankaccountvalidation/)
  - [Geocode](/developers/api/distancesanddirections/)
  - [Generic Errors](/developers/api/generic-errors/)
  :::
- [Sandbox](/developers/sandbox/)
- [FAQs](#){aria-expanded="false" toggle="dropdown" role="button"}

  ::: dd
  - [Address Capture](/developers/faqs/Address-Capture)
  - [Address Verification](/developers/faqs/Address-Verification)
  - [Bank Account
    Verification](/developers/faqs/Bank-Account-Verification)
  - [Common account errors](/developers/faqs/Common-account-errors)
  - [Data Maintenance Annual
    Subscription](/developers/faqs/Data-Maintenance-Annual-Subscription)
  - [Email Verification](/developers/faqs/Email-Verification)
  - [General](/developers/faqs/General)
  - [Geocoding](/developers/faqs/Geocoding)
  - [Geolocation](/developers/faqs/Geolocation)
  - [Phone Verification](/developers/faqs/Phone-Verification)
  - [Technical](/developers/faqs/Technical)
  :::
:::

::::::::::::::::::::::::::::::::::::::::::: {.gd__i .section .content .c9 style=" --cspan:9; --rspan:1; --cstart:auto;"}
::::::: {.section .gd__s .pbtm--64}
:::::: {.gd__a style="--cols: 12;--cspan: 12; --rspan: 1;"}
::::: {.gd__c style="--cols:12"}
:::: {.gd__i .tile .c12 style=" --cspan:12; --rspan:1; --cstart:auto;"}
- [Developers](/developers/)
- /
- [Guides](/developers/guides/)
- /
- The Loqate commercetools Integration: Setup Guide

::: rte--centre-all
# The Loqate commercetools Integration: Setup Guide
:::
::::
:::::
::::::
:::::::

::::::::::::::::::::::::::::::::::::: gd
:::::::::::::::::::::::::::::::::::: {.gd__c style="--cols:12"}
::::::::::::::::::::::::::::::::::: {.gd__i .section .gd--cen .full-width .pbtm--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
:::::::::::::::::::::::::::::::::: {.section .gd__s}
::::::::::::::::::::::::::::::::: {.gd__a style="--cols: 12;--cspan: 12; --rspan: 1;"}
:::::::::::::::::::::::::::::::: {.gd__c style="--cols:12"}
:::: {.gd__i .rte .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## Prerequisites {#TheLoqateCommercetoolsIntegration:SetupGuide-Prerequisites}

- Node.js 18.16.0 or higher
- Yarn 1.22.19 or higher
- A commercetools project
- commercetools Frontend Studio
- [A Loqate API
  key](https://www.loqate.com/developers/getting-started/creating-api-keys/){.external-link
  rel="noopener" target="_blank"}
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## Disclaimers {#TheLoqateCommercetoolsIntegration:SetupGuide-Disclaimers}

- The loqate-commercetools repository is meant to be used as a reference
  to integrate Loqate services into a commercetools B2C Frontend project
- In order to do so, you will need to get the latest version of the
  commercetools B2C Frontend template and apply the changes described in
  the [Backend-for-Frontend Changes](#Backend){.external-link
  anchor="#Backend"} and [Frontend Changes](#Frontend){.external-link
  anchor="#Frontend"} sections on top of your existing implementation
- On the frontend, the visual appearance of this Loqate integration is
  meant to be relatively simple and independent so that it can be
  carried over to your own project with minimal effort
- On the backend-for-frontend, the Loqate integration is implemented so
  that it can be carried over to your own project with minimal effort
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## Installation {#TheLoqateCommercetoolsIntegration:SetupGuide-Installation}

- Clone [the
  repository](https://github.com/loqate/loqate-commercetools){.external-link
  rel="noopener" target="_blank"}
- Run the standard commercetools Frontend setup process as described in
  the [commercetools Frontend development
  docs](https://docs.commercetools.com/frontend-development/cli){.external-link
  rel="noopener" target="_blank"}

## Project configuration - Studio settings

Please refer to the [Studio
Settings](/developers/guides/commercetools-integration-studio-settings/ "Commercetools Integration: Studio Settings"){.external-link
rel="noopener" target="_blank"} documentation for instructions on how to
configure the project.
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## []{#Backend}Backend-for-frontend changes {#TheLoqateCommercetoolsIntegration:SetupGuide-Backend-for-frontendchanges}

### ** LoqateController** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.LoqateController}

The `LoqateController`{.language-plaintext .highlighter-rouge} is a key
component that interacts with the Loqate API to handle address capture,
address verification, and validation for email and phone numbers. It
serves as the gateway for these services, ensuring they are integrated
within the commercetools environment.

#### **Key features:** {#TheLoqateCommercetoolsIntegration:SetupGuide-Keyfeatures:}

- **Loqate API Client:** the controller initializes
  the `LoqateApi`{.language-plaintext .highlighter-rouge} client,
  configured with project settings like API key, address quality
  threshold, and validation timeouts
- **Address Management:** it provides methods for capturing, verifying,
  and validating addresses based on user input
- **Email & Phone Validation:** the controller includes email and phone
  validation methods that ensure the correctness of these fields as per
  the rules defined in the Loqate API
- **IP-based Country Detection:** it also enables the retrieval of the
  user's country based on their IP address for better geolocation-based
  address suggestions

### **Controller functions overview** {#TheLoqateCommercetoolsIntegration:SetupGuide-Controllerfunctionsoverview}

#### ** 1. `createLoqateApi(actionContext: ActionContext): LoqateApi`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** this function creates
  a `LoqateApi`{.language-plaintext .highlighter-rouge} client instance
  using the project configuration. The API key, address verification
  threshold, and other settings are passed to the client. This ensures
  that each API call is correctly authenticated and configured according
  to the commercetools project
- **Use case:** called internally by the controller before making
  requests to the Loqate API

#### ** 2. `getAddresses(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

\

- **Description:** this function handles address lookup requests. It
  takes user-provided details (like text, city, country) and returns
  address suggestions from the Loqate API. The result is a list of
  possible address matches based on the input
- **Use case:** used during My Account adding of new address or checkout
  forms to provide real-time address suggestions as the user types
- **Parameters:**
  - `request`{.language-plaintext .highlighter-rouge}: contains query
    parameters such as `id`{.language-plaintext
    .highlighter-rouge}, `address`{.language-plaintext
    .highlighter-rouge}, `countryIsoCode`{.language-plaintext
    .highlighter-rouge}, and `city`{.language-plaintext
    .highlighter-rouge}
  - `actionContext`{.language-plaintext .highlighter-rouge}: provides
    access to the current commercetools project configuration
- **Response:** returns a list of matching addresses in JSON format

#### ** 3. `verifyAddress(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

\

- **Description:** verifies the accuracy of a provided address by
  checking against Loqate's address verification system. It validates
  fields such as country, postal code, and city
- **Use case:** called when the user submits a form that requires
  verified address data, such as during checkout
- **Parameters:**
  - `request`{.language-plaintext .highlighter-rouge}: contains the
    address details (`country`{.language-plaintext
    .highlighter-rouge}, `postalCode`{.language-plaintext
    .highlighter-rouge}, `city`{.language-plaintext .highlighter-rouge},
    and `address`{.language-plaintext .highlighter-rouge}) to be
    verified
  - `actionContext`{.language-plaintext .highlighter-rouge}: accesses
    the commercetools project configuration
- **Response:** returns whether the address is valid, questionable, or
  invalid

#### ** 4. `getCountryByIp(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** retrieves the country of the user based on their IP
  address, leveraging Loqate's IP-to-country service. If the request
  does not directly provide the client IP, it attempts to extract it
  from the `x-forwarded-for`{.language-plaintext
  .highlighter-rouge} headers
- **Use case:** used to pre-fill the country field in checkout or
  registration forms for a better user experience
- **Parameters:**
  - `request`{.language-plaintext .highlighter-rouge}: contains the
    client IP address or retrieves it from headers
  - `actionContext`{.language-plaintext .highlighter-rouge}: provides
    the commercetools project configuration
- **Response:** returns the country detected from the user's IP address

#### ** 5. `validateEmail(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** validates an email address using Loqate's Email
  Validation service, ensuring that the email is correctly formatted and
  that it meets the required validation criteria
- **Use case:** used to validate email addresses during registration,
  checkout, or other form submissions where email accuracy is essential
- **Parameters:**
  - `request`{.language-plaintext .highlighter-rouge}: contains the
    email address to be validated
  - `actionContext`{.language-plaintext .highlighter-rouge}: accesses
    project configuration for Email Validation settings
- **Response:** returns the validation status of the email (e.g., valid,
  invalid, or catch-all)

#### ** 6. `validatePhone(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** validates a phone number provided by the user using
  Loqate's Phone Validation service, ensuring the phone number format is
  correct and valid for the given country
- **Use case:** typically used during checkout or registration to ensure
  that users provide valid contact numbers
- **Parameters:**
  - `request`{.language-plaintext .highlighter-rouge}: contains the
    phone number and the country code for validation
  - `actionContext`{.language-plaintext .highlighter-rouge}: provides
    project-specific settings for phone validation
- **Response:** returns the validation status of the phone number

#### ** 7. `getSettings(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** retrieves and returns the project settings related to
  the Loqate integration. These settings determine the behaviour of
  Address Capture, Address Verify, Email Validation and Phone Validation
  features
- **Use case:** this function is used to get the current Loqate-related
  settings for specific use cases, such as checkout or account
  management
- **Response:** returns a JSON object containing the current
  configuration for Loqate in the project

#### ** 8. `getRestrictedListedCountries(request: Request, actionContext: ActionContext): Promise<Response>`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.createLoqateApi(actionContext:ActionContext):LoqateApi}

- **Description:** fetches a list of countries that are restricted from
  using Loqate services in the current project. This can be used to
  prevent address capture or validation in specific regions
- **Use case:** used in form validations to check if a user's country is
  restricted before allowing further actions
- **Response:** returns a JSON object containing restricted countries

### **LoqateApi class overview** {#TheLoqateCommercetoolsIntegration:SetupGuide-LoqateApiclassoverview}

#### ** Key Methods in `LoqateApi`{.language-plaintext .highlighter-rouge}** {#TheLoqateCommercetoolsIntegration:SetupGuide-KeyMethodsinLoqateApi}

- **`getAddresses()`{.language-plaintext .highlighter-rouge}**: fetches
  address suggestions based on user input
- **`verifyAddress()`{.language-plaintext .highlighter-rouge}**:
  verifies the accuracy of a provided address
- **`getCountryByIp()`{.language-plaintext .highlighter-rouge}**:
  retrieves the user's country based on their IP address
- **`validateEmail()`{.language-plaintext .highlighter-rouge}**:
  validates the format and deliverability of an email address
- **`validatePhone()`{.language-plaintext .highlighter-rouge}**:
  validates the format and correctness of a phone number

### **Utility functions** {#TheLoqateCommercetoolsIntegration:SetupGuide-Utilityfunctions}

####  [**`isValidAddress(matchScore, addressVerificationLevel, goodAddressMinimumMatchscore)`{.language-plaintext .highlighter-rouge}**](https://confluence.gbgplc.com/display/LQTDOC/The+Loqate+Commercetools+Integration%3A+Setup+Guide#TheLoqateCommercetoolsIntegration:SetupGuide-isValidAddress(matchScore,addressVerificationLevel,goodAddressMinimumMatchscore)){.clickable-anchors-plugin-link} {#TheLoqateCommercetoolsIntegration:SetupGuide-isValidAddress(matchScore,addressVerificationLevel,goodAddressMinimumMatchscore)}

- **Description:** checks if an address is valid based on its matchscore
  and verification level
- **Use Case:** used to determine if an address should be accepted as
  valid, questionable, or invalid

#### [**`extractDescription(description)`{.language-plaintext .highlighter-rouge}**](https://confluence.gbgplc.com/display/LQTDOC/The+Loqate+Commercetools+Integration%3A+Setup+Guide#TheLoqateCommercetoolsIntegration:SetupGuide-extractDescription(description)){.clickable-anchors-plugin-link} {#TheLoqateCommercetoolsIntegration:SetupGuide-extractDescription(description)}

- **Description:** extracts the postal code and city from an address
  description string
- **Use Case:** used internally to parse and normalise address data

#### [**`extractCountryIsoCode(id)`{.language-plaintext .highlighter-rouge}**](https://confluence.gbgplc.com/display/LQTDOC/The+Loqate+Commercetools+Integration%3A+Setup+Guide#TheLoqateCommercetoolsIntegration:SetupGuide-extractCountryIsoCode(id)){.clickable-anchors-plugin-link} {#TheLoqateCommercetoolsIntegration:SetupGuide-extractCountryIsoCode(id)}

- **Description:** extracts the country ISO code from an address ID
  string
- **Use Case:** helps to normalise address data
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## []{#Frontend}Frontend changes {#TheLoqateCommercetoolsIntegration:SetupGuide-Backend-for-frontendchanges}

### ** Loqate Context** {#TheLoqateCommercetoolsIntegration:SetupGuide-1.LoqateController}

The `LoqateContext`{.language-plaintext .highlighter-rouge} provides a
centralized state management system for Loqate-related features such as
address capture, address verification, email validation, and phone
validation. It encapsulates multiple Loqate API integrations and makes
them accessible to components throughout the application via React's
context API.

**Key Responsibilities:**

- **Address Lookup:** Listens to user input and fetches address
  suggestions from the Loqate API, debouncing the requests to reduce
  unnecessary API calls. The context updates the suggested addresses
  list and allows the user to select an address.
- **Address Verification:** Verifies the address provided by the user
  using the Loqate API. It triggers validation when an address is
  manually entered or submitted. The context validates the address based
  on the Loqate response, ensuring its accuracy.
- **Email and Phone Validation:** Integrates email and phone number
  validation, with the ability to validate inputs using the
  corresponding Loqate APIs. Results are stored in the context for use
  across components like checkout or user account management.
- **IP-to-Country Mapping:** Automatically fills in the country based on
  the user's IP address, improving user experience and preventing
  invalid country selections.

Here's a detailed description of the exposed functions in
the `LoqateContext`{.language-plaintext .highlighter-rouge}:

**Exposed functions\
\
**

1.  **`setLoqateAddress(value: LoqateAddress)`{.language-plaintext
    .highlighter-rouge}**
    - **Description:** updates the current address stored in the context
      based on the user's input or address selection. It triggers
      address suggestions when the input changes and resets the address
      verification state if the address changes
    - **Use case:** called whenever the user updates their address
      input, whether through manual input or selecting an address from
      the suggestions dropdown
    - **Parameters:**
      - `value`{.language-plaintext .highlighter-rouge}: the updated
        address object containing fields like `text`{.language-plaintext
        .highlighter-rouge}, `city`{.language-plaintext
        .highlighter-rouge}, `countryIsoCode`{.language-plaintext
        .highlighter-rouge}, etc.\
        \

2.  **`verifyAddress(loqateAddress: LoqateAddress): Promise<LoqateIsValidAddress>`{.language-plaintext
    .highlighter-rouge}**

    - **Description:** verifies the provided address using the Loqate
      API to ensure it's valid. It returns
      a `LoqateIsValidAddress`{.language-plaintext
      .highlighter-rouge} object, indicating whether the address is
      valid or not
    - **Use case:** used to validate addresses during adding of new
      address in My Account or checkout processes where accurate address
      entry is critical
    - **Parameters:**
      - `loqateAddress`{.language-plaintext .highlighter-rouge}: the
        address object that needs to be verified
    - **Returns:** a promise resolving to an object
      with `isValid: true`{.language-plaintext
      .highlighter-rouge} or `false`{.language-plaintext
      .highlighter-rouge} depending on whether the address is valid\
      \

3.  **`validateEmail(): Promise<boolean | undefined>`{.language-plaintext
    .highlighter-rouge}**

    - **Description:** validates the email address associated with the
      current Loqate address. If Email Validation is enabled in the
      Loqate settings, it sends the email to Loqate's validation API and
      updates the context with the result
    - **Use case:** triggered to validate an email when users input
      their email address in a form, commonly during registration or
      checkout
    - **Returns:** a promise resolving to a boolean indicating whether
      the email is valid (`true`{.language-plaintext
      .highlighter-rouge}/`false`{.language-plaintext
      .highlighter-rouge}), or `undefined`{.language-plaintext
      .highlighter-rouge} if validation is not enabled\
      \

4.  **`validatePhone(): Promise<boolean | undefined>`{.language-plaintext
    .highlighter-rouge}**

    - **Description:** validates the phone number provided in
      the `LoqateAddress`{.language-plaintext .highlighter-rouge} object
      using the Loqate API. If Phone Validation is enabled, it checks
      the number's format and correctness based on the country
    - **Use case:** used to validate phone numbers during form
      submission (e.g., in checkout forms) to ensure that the provided
      number is valid
    - **Returns:** a promise resolving to a boolean indicating whether
      the phone number is valid (`true`{.language-plaintext
      .highlighter-rouge}/`false`{.language-plaintext
      .highlighter-rouge}), or `undefined`{.language-plaintext
      .highlighter-rouge} if validation is not enabled\
      \

5.  **`setBypassAddressVerification(bypass: boolean)`{.language-plaintext
    .highlighter-rouge}**

    - **Description:** sets a flag to bypass Address Verify. This is
      useful in scenarios where the user wants to skip the verification
      process or manually override an invalid address
    - **Use case:** typically used when users manually input invalid or
      questionable addresses and opt to bypass automatic verification
      for any reason by
    - **Parameters:**
      - `bypass`{.language-plaintext .highlighter-rouge}: a boolean
        value that, when set to `true`{.language-plaintext
        .highlighter-rouge}, bypasses Address Verify\
        \

6.  **`setLoqateSettings(loqateSettings: LoqateSettings)`{.language-plaintext
    .highlighter-rouge}**
    - **Description:** updates the Loqate settings used for address
      lookup and validation, including enabling or disabling email,
      phone, and address validation features
    - **Use case:** used to configure or reconfigure Loqate settings
      dynamically (e.g., different pages might require different
      settings)
    - **Parameters:**
      - `loqateSettings`{.language-plaintext .highlighter-rouge}: the
        settings object that dictates how Loqate functionality is used
        (e.g., enabling/disabling email or phone validation)\
        \

The context handles API calls using RxJS operators
like `debounceTime`{.language-plaintext
.highlighter-rouge}, `distinctUntilChanged`{.language-plaintext
.highlighter-rouge}, and `switchMap`{.language-plaintext
.highlighter-rouge} to manage user input efficiently and ensure smooth
address verification and lookup processes.
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
### Address Capture {#TheLoqateCommercetoolsIntegration:SetupGuide-1.LoqateController}

The `AddressCapture`{.language-plaintext .highlighter-rouge} component
is responsible for capturing and suggesting addresses based on user
input. It integrates seamlessly with the Loqate Context and allows for
dynamic address suggestions and selection.

**Key features:**

- **Input field:** the component displays an input field where users can
  begin typing their address. As they type, the component fetches
  address suggestions from Loqate based on the user's input
- **Address suggestions dropdown:** while the input field is focused,
  the component shows a dropdown of suggested addresses. These
  suggestions come from the Loqate API, and users can click on any
  suggestion to populate the address fields automatically
- **Manual and auto address handling:** the component supports both
  manual entry and auto-selection of addresses. If a user selects an
  address from the dropdown, the address is treated as an auto-populated
  value, while manual entries bypass the suggestion feature
- **Debouncing and API efficiency:** to minimize API calls, user input
  is debounced, ensuring that requests are only sent after a specified
  delay in typing
- **Handling nested addresses (address containers):** in cases where the
  address suggestion is a container (e.g., a boulevard that contains
  many addresses), the component displays an icon, allowing the user to
  recognize such cases and continue refining their search
:::
::::

:::: {.gd__i .rte .mtop--32 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
## Restricted Countries {#TheLoqateCommercetoolsIntegration:SetupGuide-Backend-for-frontendchanges}

This code defines a React custom hook
called `useRestrictedCountries`{.language-plaintext
.highlighter-rouge} that retrieves and manages the list of countries
that are not restricted, filtering out any countries that are restricted
based on an external API call to
the `loqate/getRestrictedCountries`{.language-plaintext
.highlighter-rouge} action via the `commercetools`{.language-plaintext
.highlighter-rouge} SDK.

#### Key elements   {#TheLoqateCommercetoolsIntegration:SetupGuide-Keyelements}

1.  **State management**:

    - `countries`{.language-plaintext .highlighter-rouge}: this state
      holds the list of available countries, which is initialized with a
      static list of all countries (`allCountries`{.language-plaintext
      .highlighter-rouge})
    - `fetchingInProgress`{.language-plaintext .highlighter-rouge}: a
      boolean state to track if the fetching process is currently
      ongoing
    - `successfullyFetched`{.language-plaintext .highlighter-rouge}: a
      boolean state indicating whether the fetching was successfully
      completed\
      \

2.  **API integration**:

    - The `fetchRestrictedCountries`{.language-plaintext
      .highlighter-rouge} function asynchronously calls
      the `loqate/getRestrictedCountries`{.language-plaintext
      .highlighter-rouge} API action using
      the `commercetools SDK`{.language-plaintext .highlighter-rouge}.
      It expects a response containing restricted country codes\
      \

3.  **Logic for filtering restricted countries**:

    - The API response provides a list of restricted countries
    - The list of restricted countries is mapped and filtered to remove
      any invalid entries (i.e., missing or empty country codes)
    - The hook filters out the restricted countries from the full list
      (`allCountries`{.language-plaintext .highlighter-rouge})\
      \

4.  **Side effects (useEffect)**:

    - On component mount, the hook triggers the API call to fetch
      restricted countries
    - During this process, `fetchingInProgress`{.language-plaintext
      .highlighter-rouge} is set to `true`{.language-plaintext
      .highlighter-rouge} and `successfullyFetched`{.language-plaintext
      .highlighter-rouge} is updated based on whether the call succeeds
      or fails
    - In case of an error, the hook logs the error and falls back to the
      default list of all countries\
      \

5.  **Observable and RxJS integration**:

    - The code uses RxJS operators (`map`{.language-plaintext
      .highlighter-rouge}, `tap`{.language-plaintext
      .highlighter-rouge}, `catchError`{.language-plaintext
      .highlighter-rouge}) to handle the API call, map the response, and
      manage error handling
    - The `subscribe`{.language-plaintext .highlighter-rouge} function
      applies the country filtering logic and updates
      the `countries`{.language-plaintext .highlighter-rouge} state
      accordingly
:::
::::

:::: {.gd__i .rte .mtop--64 .c12 style="--cspan:12;--rspan:1;--cstart:1;"}
::: api_documentation_container
### Navigation {#TheLoqateCommercetoolsIntegration:FeatureOverview-AddressCapture}
:::
::::

::::::::::::::: {.gd__i .section .full-width .c12 style="--cspan:12;--rspan:1;--cstart:auto;"}
:::::::::::::: {.section .gd__s}
::::::::::::: {.gd__a style="--cols: 12;--cspan: 12; --rspan: 1;"}
:::::::::::: {.gd__c style="--cols:12"}
::::: {.gd__i .tile .bg-white .c6 style="--cspan:6;--rspan:1;--cstart:auto;"}
:::: {.tile-item .tile-item--haslink .tile-item--horizontal style="--b:var(--cl-white);"}
[](/developers/guides/commercetools-integration/){.tile-item__link}
![](/media/kxqpoofe/guide-book-report.svg?rnd=133277664040230000){loading="lazy"}

::: tile__content
##### The Loqate commercetools Integration: Overview

Learn the basics of the integration.
:::
::::
:::::

::::: {.gd__i .tile .bg-white .c6 style="--cspan:6;--rspan:1;--cstart:auto;"}
:::: {.tile-item .tile-item--haslink .tile-item--horizontal style="--b:var(--cl-white);"}
[](/developers/guides/commercetools-integration-feature-overview/){.tile-item__link}
![](/media/kxqpoofe/guide-book-report.svg?rnd=133277664040230000){loading="lazy"}

::: tile__content
##### The Loqate commercetools Integration: Feature Overview

Review the Loqate products available in the integration.
:::
::::
:::::

::::: {.gd__i .tile .bg-white .c6 style="--cspan:6;--rspan:1;--cstart:auto;"}
:::: {.tile-item .tile-item--haslink .tile-item--horizontal style="--b:var(--cl-white);"}
[](/developers/guides/commercetools-integration-setup-guide/){.tile-item__link}
![](/media/cxefbq0r/api-code.svg?rnd=133277663077300000){loading="lazy"}

::: tile__content
##### The Loqate commercetools Integration: Studio Settings

Configure the Loqate plugin in the commercetools Studio.
:::
::::
:::::
::::::::::::
:::::::::::::
::::::::::::::
:::::::::::::::
::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::::::
